require 'pentest/endpoint'

module Pentest
  class Runner
    def initialize
      @routes = ::Rails.application.routes.routes
    end

    def run
      @endpoints = @routes.map do |route|
        endpoint = Endpoint.new(route)
      end.select(&:valid?)

      Logger.debug "Fetched #{@endpoints.size} endpoints"

      user = User.first
      user.admin = true
      user.save!

      payloads = []
      @endpoints.each do |endpoint|
        payloads += endpoint.scan!
        Logger.print_seperator
      end

      pp payloads
    end
  end
end