module Pentest
  class Runner
    def initialize
      @routes = ::Rails.application.routes.routes
    end

    def run

    end

    def run_route(route)
      controller = route.defaults[:controller]
      action = route.defaults[:action]
      # next unless controller == "users" && action == "update"
      if controller.nil? || action.nil?
        # puts "#{' ' * 6} Skipping because there's no mapping to controller...".yellow
        next
      end

      controller_name = ActiveSupport::Inflector.camelize(controller) + "Controller"
      controller_class = ActiveSupport::Inflector.constantize(controller_name)

      controller_instance = controller_class.new
      begin
        exp = get_sexp controller_instance.method(action.to_sym)
      rescue NameError => e
        # puts "#{' ' * 6} Skipping because there's no valid implementation of #{controller_class.inspect}##{action}...".yellow
        next
      end
    end

    private

    def is_valid_route(route)
      controller = route.defaults[:controller]
      action = route.defaults[:action]
      !controller.nil? && !action.nil?
    end
  end
end