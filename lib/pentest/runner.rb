require 'pentest/endpoint'

module Pentest
  class Runner
    def initialize
      @routes = ::Rails.application.routes.routes
    end

    def run
      @endpoints = @routes.map do |route|
        endpoint = Endpoint.new(route)
      end.select(&:valid?)

      Logger.debug "Fetched #{@endpoints.size} endpoints"

      @endpoints.each do |endpoint|
        endpoint.scan!
      end
    end
  end
end